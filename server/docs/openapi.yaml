openapi: 3.0.3

info:
  title: SignalStream API
  description: |
    SignalStream backend API.
    Token-based authentication using Bearer tokens.
  version: 1.0.0

servers:
  - url: http://localhost:8080
    description: Local development

# =========================
# Security
# =========================
security:
  - bearerAuth: []

paths:

  # ---------- AUTH ----------
  /auth/register:
    post:
      summary: Register a new user
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        "200":
          description: Registered user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDTO"
        "400":
          $ref: "#/components/responses/BadRequest"

  /auth/login:
    post:
      summary: Login user
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                password:
                  type: string
      responses:
        "200":
          description: Session created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SessionDTO"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /auth/me:
    get:
      summary: Get current user
      tags: [Auth]
      responses:
        "200":
          description: Current user
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDTO"
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ---------- TAGS ----------
  /tags:
    get:
      summary: List all tags
      tags: [Tags]
      security: []
      responses:
        "200":
          description: Tag list
          content:
            application/json:
              schema:
                type: object
                properties:
                  tags:
                    type: array
                    items:
                      $ref: "#/components/schemas/TagDTO"

    post:
      summary: Create tag (admin only)
      tags: [Tags]
      responses:
        "200":
          description: Created tag
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TagDTO"
        "403":
          $ref: "#/components/responses/Forbidden"

  # ---------- ITEMS ----------
  /items:
    get:
      summary: List items
      tags: [Items]
      security: []
      parameters:
        - $ref: "#/components/parameters/limit"
        - $ref: "#/components/parameters/offset"
      responses:
        "200":
          description: Item list
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/ItemDTO"
                  meta:
                    $ref: "#/components/schemas/PaginationMeta"

    post:
      summary: Create item (moderator/admin)
      tags: [Items]
      responses:
        "200":
          description: Created item
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ItemDTO"
        "403":
          $ref: "#/components/responses/Forbidden"

  /items/{id}:
    get:
      summary: Get item
      tags: [Items]
      security: []
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Item
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ItemDTO"
        "404":
          $ref: "#/components/responses/NotFound"

    delete:
      summary: Delete item (moderator/admin)
      tags: [Items]
      parameters:
        - $ref: "#/components/parameters/id"
      responses:
        "200":
          description: Deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: boolean
        "403":
          $ref: "#/components/responses/Forbidden"

  # ---------- FEED ----------
  /feed:
    get:
      summary: Personalized feed
      tags: [Feed]
      parameters:
        - $ref: "#/components/parameters/limit"
        - $ref: "#/components/parameters/offset"
      responses:
        "200":
          description: Feed
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: "#/components/schemas/FeedItemDTO"
                  meta:
                    $ref: "#/components/schemas/PaginationMeta"

# =========================
# Components
# =========================
components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: UUID

  parameters:
    id:
      name: id
      in: path
      required: true
      schema:
        type: integer

    limit:
      name: limit
      in: query
      schema:
        type: integer
        default: 20

    offset:
      name: offset
      in: query
      schema:
        type: integer
        default: 0

  responses:
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        code:
          type: string

    PaginationMeta:
      type: object
      properties:
        limit:
          type: integer
        offset:
          type: integer

    UserDTO:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
        role:
          type: string

    SessionDTO:
      type: object
      properties:
        token:
          type: string

    TagDTO:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    ItemDTO:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        url:
          type: string

    FeedItemDTO:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        url:
          type: string
        tags:
          type: array
          items:
            $ref: "#/components/schemas/TagDTO"